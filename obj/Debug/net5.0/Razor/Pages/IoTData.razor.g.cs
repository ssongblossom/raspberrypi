#pragma checksum "/home/pi/Projects/dataWebsite/Pages/IoTData.razor" "{ff1816ec-aa5e-4d10-87f7-6f4963833460}" "0b84186b7596320d380af6ccb94b79197c75b22d"
// <auto-generated/>
#pragma warning disable 1591
namespace dataWebsite.Pages
{
    #line hidden
    using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Threading.Tasks;
    using Microsoft.AspNetCore.Components;
#nullable restore
#line 1 "/home/pi/Projects/dataWebsite/_Imports.razor"
using System.Net.Http;

#line default
#line hidden
#nullable disable
#nullable restore
#line 2 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 3 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Components.Authorization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 4 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Components.Forms;

#line default
#line hidden
#nullable disable
#nullable restore
#line 5 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Components.Routing;

#line default
#line hidden
#nullable disable
#nullable restore
#line 6 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Components.Web;

#line default
#line hidden
#nullable disable
#nullable restore
#line 7 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.AspNetCore.Components.Web.Virtualization;

#line default
#line hidden
#nullable disable
#nullable restore
#line 8 "/home/pi/Projects/dataWebsite/_Imports.razor"
using Microsoft.JSInterop;

#line default
#line hidden
#nullable disable
#nullable restore
#line 9 "/home/pi/Projects/dataWebsite/_Imports.razor"
using dataWebsite;

#line default
#line hidden
#nullable disable
#nullable restore
#line 10 "/home/pi/Projects/dataWebsite/_Imports.razor"
using dataWebsite.Shared;

#line default
#line hidden
#nullable disable
#nullable restore
#line 11 "/home/pi/Projects/dataWebsite/_Imports.razor"
using System.IO.Ports;

#line default
#line hidden
#nullable disable
    [Microsoft.AspNetCore.Components.RouteAttribute("/iotdata")]
    public partial class IoTData : Microsoft.AspNetCore.Components.ComponentBase
    {
        #pragma warning disable 1998
        protected override void BuildRenderTree(Microsoft.AspNetCore.Components.Rendering.RenderTreeBuilder __builder)
        {
            __builder.AddMarkupContent(0, "<h1>IoT Data</h1>\n\n");
            __builder.OpenElement(1, "p");
            __builder.AddContent(2, "Current status : ");
            __builder.AddContent(3, 
#nullable restore
#line 6 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
                     isRunning

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
            __builder.AddMarkupContent(4, "\n\n\n");
            __builder.OpenElement(5, "button");
            __builder.AddAttribute(6, "class", "btn btn-primary");
            __builder.AddAttribute(7, "onclick", Microsoft.AspNetCore.Components.EventCallback.Factory.Create<Microsoft.AspNetCore.Components.Web.MouseEventArgs>(this, 
#nullable restore
#line 9 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
                                              startOrStop

#line default
#line hidden
#nullable disable
            ));
            __builder.AddContent(8, 
#nullable restore
#line 9 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
                                                            status

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
#nullable restore
#line 13 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
 for(int i=0; i<10; i++)
{

#line default
#line hidden
#nullable disable
            __builder.OpenElement(9, "p");
            __builder.AddContent(10, 
#nullable restore
#line 15 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
        strArr[i]

#line default
#line hidden
#nullable disable
            );
            __builder.AddContent(11, " : ");
            __builder.AddContent(12, 
#nullable restore
#line 15 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
                     dataArr[i]

#line default
#line hidden
#nullable disable
            );
            __builder.CloseElement();
#nullable restore
#line 16 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
}

#line default
#line hidden
#nullable disable
        }
        #pragma warning restore 1998
#nullable restore
#line 19 "/home/pi/Projects/dataWebsite/Pages/IoTData.razor"
      
    static bool isRunning = false;
    static bool isOpen = false;
    string status; //START OR STOP
    SerialPort BSerialPort = new SerialPort("/dev/rfcomm0");
    string[] strArr = new string[] {"DHT11", "DHT22", "DM460", "DM2007", "CO", "Alcohol", "CO2", "Tolueno", "NH4", "Acetona"};
    string[] dataArr =new string[10];
    protected override async Task OnInitializedAsync()
    {
        BSerialPort.BaudRate = 9600;
        BSerialPort.DataReceived += new SerialDataReceivedEventHandler(DataReceivedHandler);
        System.Console.WriteLine("OnInitializedAsync");
    }
    private void openPort()
    {
        try
        {
            if (!BSerialPort.IsOpen)
            { 
                BSerialPort.Open(); //만약 포트가 열려있지 않다면 엽시다.
            }
        }
        catch (Exception ex)
        {
            System.Console.WriteLine(ex.Message);//예외일 때 보여주기
        }
    }
    private void startOrStop()
    {
        if(!BSerialPort.IsOpen)
            openPort();
        
        if(!isRunning)
        {
            status ="STOP";
            BSerialPort.Write("1");
            isRunning = true;
        }
        else
        {
            status = "START";
            BSerialPort.Write("2");
            isRunning = false;
        }
    }

    private void DataReceivedHandler(object sender, SerialDataReceivedEventArgs e)
        {
            try
            {
                SerialPort spl = (SerialPort)sender;
                string recievedData = spl.ReadLine();
                System.Console.WriteLine($"{recievedData}");
                //DataProcessor(recievedData);
            }
            catch (Exception ex)
            {
                System.Console.WriteLine("Fail to recieve the data\n\r");
            }
        }
    
    
    /*
    private void DataProcessor(string recievedData)
    {
        string result ="";
        string strData = recievedData.Substring(0,recievedData.Length-1);

        //받은 데이터가 어떤 센서의 데이터인지 구하기 
        int index = 0;
        for(int i=0; i<10; i++)
        {
            if(strData.Contains(strArr[i]))
            {
                index = i;
                break;
            }
        }

        //데이터를 ':'를 기준으로 split 0번째에는 센서이름, 1번째에는 센서 값
        string[] datas = strData.Split(':');
        datas[1].Replace(" ",""); // " " 제거
        
        //센서의 종류에 따라서 데이터 가공하기
        if(index ==0 || index ==1 )//dht11 or dht22
        {
            datas[1].Replace("(", ""); // "(" 제거
            datas[1].Replace(")", ""); // ")" 제거
            string[] subs = datas[1].Split(',');
            result = "TEMP: " + subs[0] + " HUMIDITY : " +subs[1];  
        }
        else
        {
            result = datas[1];
        }

        //결과값을 dataArr에 넣어주기
        dataArr[index] = result;
    }
    */
    





#line default
#line hidden
#nullable disable
    }
}
#pragma warning restore 1591
